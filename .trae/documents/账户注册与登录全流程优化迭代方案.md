## 当前状态梳理
- 前端登录注册：`src/pages/Login.tsx:23-57` 使用邮箱+密码登录与注册，支持 GitHub OAuth 按钮；已移除手机号与“认证表”字段；新增了更友好的错误提示。
- 认证存储：登录成功后在 `src/stores/authStore.ts:26-35` 里保存 `auth_token` 至 `localStorage`，再调用 `api.getUserInfo` 获取用户信息。
- 请求封装：`src/lib/api.ts:17-33` 统一携带 `Authorization` 与 `APP_ID`，提供 `/login/passwd`、`/login/register`、`/getUserInfo`。
- 未登录状态：各 Store `skipHydration:true`，Dashboard 未登录时引导登录（`src/pages/Dashboard.tsx`）。
- 设置页：`src/pages/Settings.tsx` 聚焦产品内显示/通知/备份等设置，暂无“账户资料编辑/密码修改”入口。
- OAuth 回调：`src/pages/AuthCallback.tsx` 已配置路由，但回调后的账户合并/补充资料待完善。
- 后端现状：Docker 已有 MySQL 与 Nginx 服务，后端容器启动不稳定，导致前端出现“无法连接到服务器”提示（注册、登录请求失败）。

## 目标产品逻辑（专业PM视角）
- 账户生命周期完整闭环：注册 → 邮箱验证 → 首次登录 → 首次引导（完善昵称/头像）→ 正常登录 → 进入系统自动拉取账户数据 → 可编辑账户信息 → 修改密码/找回密码 → 退出登录 → 重新登录。
- 登录方式：
  - 标准登录：邮箱 + 密码（仅保留邮箱口径）。
  - 第三方登录：GitHub OAuth；首次授权需绑定或创建本地账户（邮箱统一为主键）。
- 会话与安全：
  - 使用 JWT；前端持久化在 `localStorage`；统一 401 处理自动登出并重定向登录。
  - Token 过期前刷新（后端若提供 Refresh Token），或静默校验失败时提示重新登录。
- 进入系统数据：
  - 登录后统一拉取：User Profile、学习资源、学习进度、支付记录；未登录时不展示任何用户数据。
- 资料编辑：
  - 账户信息页可修改：昵称、头像（可选）、偏好；邮箱仅显示不可更改。
- 密码相关：
  - 修改密码：需提供当前密码 + 新密码（强度校验）。
  - 忘记密码：邮箱验证码（或魔法链接）重置密码。
- 错误反馈：
  - 后端不可达 → 明确提示“服务未启动/网络问题”；
  - 业务失败 → 展示后端 message；
  - 表单校验 → 及时校验，禁用提交按钮。

## 与现有逻辑的差异
- 邮箱验证与忘记密码：当前未实现；目标增加邮件通道与对应页面/接口。
- 账户资料编辑：当前无入口；目标在设置页新增“账户”分页（Profile & Password）。
- 数据拉取策略：当前仅 `getUserInfo`；目标在登录后串行/并行拉取资源/进度/支付数据并注入 Store；未登录清空与路由守卫更严格。
- OAuth 绑定流程：当前仅授权跳转；目标在 `AuthCallback` 完成账户创建/绑定与回填用户资料。
- 全局 401 处理与刷新策略：当前无刷新；目标在请求层统一处理。

## 迭代实施方案（分阶段）
### Phase 1：认证与入口完善
- 路由守卫：在 `App.tsx` 对受保护路由添加鉴权拦截；无 Token → 跳转登录。
- 请求层 401 处理：在 `api.ts` 统一捕获 401 → 清理 Token → 跳转登录。
- 登录后流程：`authStore.login` 成功后：
  - 拉取 `getUserInfo`；
  - 并行拉取 `resources`、`progress`、`payments`（后端 GET 接口）。
- 移除“认证表”残留参数与任何预设数据（已基本完成）。

### Phase 2：账户资料与密码功能
- 新增“设置/账户”页：
  - Profile（头像上传、昵称）→ `PUT /user/profile`；
  - Password（当前密码 + 新密码）→ `PUT /user/password`；
  - 成功后更新 `authStore.user`。
- 表单校验与安全提示：密码强度、本地预校验、失败重试策略。

### Phase 3：邮箱验证与忘记密码
- 注册后下发验证邮件：`POST /mail/sendVerify`；回调 `GET /mail/verify?token=...`。
- 登录页新增“忘记密码”入口：
  - 请求 `POST /mail/sendReset` 下发邮件；
  - 重置页 `POST /user/password/reset` 完成重置。

### Phase 4：OAuth 完整化
- `AuthCallback` 完成：携带 code 调后端 `GET /oauth2/callback/github` →
  - 若已有账户则绑定并颁发 Token；若无则创建账户并提示完善资料；
  - 统一进入 Phase 1 的拉取数据流程。

### Phase 5：数据一致性与退出流程
- 退出登录：清空 `authStore` 与各业务 Store（资源/进度/支付），并回到登录页。
- 未登录进入受保护页：显示统一空态与登录引导。

## 后端接口契约（建议）
- POST `/login/register`：{ email, password, nick_name }
- POST `/login/passwd`：{ email, password } → 返回 JWT
- GET `/getUserInfo`：返回 { id, email, nick_name, avatar }
- GET `/resources` / `/progress` / `/payments`：按用户过滤返回列表
- PUT `/user/profile`：{ nick_name?, avatar? }
- PUT `/user/password`：{ current_password, new_password }
- POST `/mail/sendVerify` / GET `/mail/verify`（可结合现有 `LoginMailController`）
- POST `/mail/sendReset` / POST `/user/password/reset`
- GET `/oauth2/authorize/github` / GET `/oauth2/callback/github`

## 前端改造点
- `App.tsx`：受保护路由与重定向；`AuthCallback` 完成后续流程。
- `authStore.ts`：登录成功后统一拉取用户与业务数据；退出时统一清空。
- 各 Store：新增 `fetchAll` / `clearAllData` 方法；登录后调用、登出时清空。
- `Settings.tsx`：新增“账户”分栏（Profile/Password）。
- `Login.tsx`：增加“忘记密码”、注册后引导验证邮箱；OAuth 登录后统一导流。
- `api.ts`：统一处理 401，按契约新增/完善接口方法。

## 安全与合规
- 密码强度策略与传输加密（HTTPS）；
- Token 过期/刷新与存储安全（仅必要信息放本地）；
- 邮件验证防刷与频率限制；
- 日志与错误上报（前端 `system/controller/SettingController` 相关能力可复用）。

## 验收与指标
- 成功注册并验证邮箱 → 首次登录自动拉取用户数据；
- 能在设置页修改昵称/头像、修改密码；
- 忘记密码流程可用；
- OAuth 登录后账户自动创建/绑定；
- 未登录无任何用户数据；401 自动登出；
- 关键流程错误提示清晰，日志可追踪。