## 目标
- 不依赖管理员接口，直接通过安装脚本初始化默认工作空间与认证数据结构，使用户密码登录在携带 `APP_ID` 时即可使用。

## 将要修改的文件
- `aipexbase/install/mysql/init.sql`

## 具体改动（SQL 片段，按顺序追加到 init.sql）
1. 创建默认工作空间记录（位于主库 `aipexbase`）
```sql
USE `aipexbase`;
INSERT INTO `app_info` (
  app_id, app_name, icon_url, need_auth, auth_table, enable_permission,
  enable_web_console, status, description, config_json, owner
) VALUES (
  'test', '默认工作空间', NULL, 1, 'users', 0,
  0, 'active', '安装脚本初始化的默认工作空间', NULL, 1
);
```
- 作用：提供默认 `APP_ID=test`，认证表为 `users`，便于用户态接口使用。

2. 创建默认工作空间数据库与表（`test` 库）
```sql
-- 创建工作空间库
CREATE DATABASE IF NOT EXISTS `test` CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci;
USE `test`;

-- 创建 users 表（与 aipexbase.users 结构一致）
CREATE TABLE IF NOT EXISTS `users` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `email` varchar(255) NOT NULL,
  `phone` varchar(255) DEFAULT NULL,
  `password` varchar(255) DEFAULT NULL,
  `last_login_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `nick_name` varchar(255) DEFAULT NULL,
  `avator` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- 创建 login 表（模型参考 Login.java）
CREATE TABLE IF NOT EXISTS `login` (
  `login_id` int NOT NULL AUTO_INCREMENT,
  `relevance_id` varchar(64) NOT NULL,
  `relevance_table` varchar(128) NOT NULL,
  `wx_open_id` varchar(255) DEFAULT NULL,
  `phone_number` varchar(255) DEFAULT NULL,
  `user_name` varchar(255) DEFAULT NULL,
  `password` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`login_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```
- 作用：将认证所需的 `users` 与 `login` 表置于工作空间库（`GlobalAppIdFilter.getAppId()` 关联），满足用户密码登录的表结构依赖。

3. （可选）初始化一个演示用户与登录记录
- 若需要开箱即用的演示账户：
```sql
-- 示例：创建一个 users 记录（密码字段可留空或填加密后字符串）
INSERT INTO `users` (email, phone, password, nick_name) VALUES ('demo@example.com', '13800000000', NULL, '演示用户');

-- 示例：创建对应 login 记录（password 建议为 Bcrypt 加密的 '123456'，可后续通过接口更新）
-- 注意：此处密码需为加密串；如暂不提供，可先置 NULL 并由后续注册流程补齐
INSERT INTO `login` (relevance_id, relevance_table, phone_number, user_name, password)
VALUES ('1', 'users', '13800000000', 'demo', NULL);
```
- 说明：`UserNameProvider` 使用 `SecurityUtils.matchesPassword` 校验密码（Bcrypt）；若立即需要可用密码示例，需填入 Bcrypt 加密串。

## 前端配置建议（不改代码，仅配置）
- 在前端项目根新增（或修改）`.env`：
```
VITE_AIPEX_API=http://localhost:8080
VITE_APP_ID=test
```
- 作用：固定 `APP_ID`，避免手动输入；前端已自动附带 `APP_ID` 与 `Authorization`。

## 验证流程
- 数据库：`aipexbase.app_info` 存在 `app_id='test'`；`test` 库存在 `users` 与 `login` 表。
- 请求头：前端或工具调用时携带 `APP_ID: test`。
- 登录：
  - 用户模式：`POST /login/passwd` 携带 `{ phone, password, relevanceTable: 'users' }`，返回 JWT；
  - 用户信息：`GET /getUserInfo` 返回当前用户。
  - 若未初始化密码，可先通过自助注册/绑定流程或补充注册接口来写入 `login.password`。

## 后续补充（不影响本次方案落地）
- 新增“用户自助注册”API：在 `LoginController.register` 中同时创建 `login` 表记录（写入加密密码与手机号），消除对管理员的依赖。
- GitHub OAuth 与资源同步：按之前规划在 `OAuth2LoginController` 接入 `github` 提供方，并实现同步服务与前端展示。

## 交付与工期
- 脚本修改与验证：0.5 天
- 可选演示用户/注册接口完善：1 天（含前端注册表单）

请确认该 SQL 修改方案（方案A）。我将按上述片段更新 `init.sql`，并协助你完成一次初始化与登录全链路验证。