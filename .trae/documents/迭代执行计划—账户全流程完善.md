## 里程碑与交付
- M1 认证与入口完善：受保护路由、统一401处理、登录后数据拉取
- M2 账户资料与密码：设置页新增“账户”分栏，资料编辑与修改密码
- M3 忘记密码与邮箱验证：邮件发送与回调、重置密码
- M4 OAuth完善：GitHub回调绑定/创建账户，合并资料与登录
- M5 退出与数据一致性：统一清空各Store、空态与守卫

## 详细实施步骤
### M1 认证与入口完善
- `src/App.tsx`：为受保护页面（Dashboard/Resources/Payments/Progress/Settings）添加鉴权守卫；无`auth_token`→重定向`/login`
- `src/lib/api.ts`：封装请求拦截与错误处理；捕获401→清理Token并跳转登录；保留`APP_ID`与JWT头
- `src/stores/authStore.ts`：
  - 登录成功后：先`getUserInfo`，并行拉取`resources/progress/payments`并写入Store
  - 新增`logout()`：清空自身与各业务Store
- 各业务Store（`resourceStore.ts / progressStore.ts / paymentStore.ts`）：
  - 新增`fetchAll()`；完善`clearAllData()`
- 登录页：保留邮箱+密码；注册后提示“去邮箱完成验证”

### M2 账户资料与密码
- `src/pages/Settings.tsx`：新增“账户”Tab（Profile/Password）
  - Profile：显示邮箱、编辑昵称、头像上传（保留占位逻辑）→ `PUT /user/profile`
  - Password：当前密码+新密码（强度校验）→ `PUT /user/password`
- 成功后更新`authStore.user`并toast反馈

### M3 忘记密码与邮箱验证
- 登录页：新增“忘记密码”入口
- 忘记密码页面：
  - `POST /mail/sendReset` 发送邮件
  - 重置页：`POST /user/password/reset` 完成重置
- 邮箱验证：注册后发送验证邮件 `POST /mail/sendVerify`；验证回调页 `GET /mail/verify?token=...` 显示结果并导流登录

### M4 OAuth 完整化
- `src/pages/AuthCallback.tsx`：基于`code`调用后端 `/oauth2/callback/github`
  - 已有账户→绑定并返回JWT；无账户→创建并返回JWT
  - 写入Token→走M1拉数流程
  - 如缺少昵称/头像→提示进入Profile完善

### M5 数据一致性与退出流程
- 退出登录：统一清空（auth、resources、progress、payments）并回到`/login`
- 未登录访问受保护页：统一空态与登录引导
- 前端错误上报：保留后端不可达提示；业务错误展示后端`message`

## 后端接口契约（对齐）
- POST `/login/register`：{ email, password, nick_name }
- POST `/login/passwd`：{ email, password } → 返回 JWT
- GET `/getUserInfo`：{ id, email, nick_name, avatar }
- GET `/resources` / `/progress` / `/payments`
- PUT `/user/profile`：{ nick_name?, avatar? }
- PUT `/user/password`：{ current_password, new_password }
- POST `/mail/sendVerify` / GET `/mail/verify`
- POST `/mail/sendReset` / POST `/user/password/reset`
- GET `/oauth2/authorize/github` / GET `/oauth2/callback/github`

## 验收标准
- 注册后邮箱验证通过，首次登录自动拉取所有用户数据
- 设置页可编辑资料与修改密码；忘记密码流程可闭环
- OAuth 登录后自动绑定/创建并进入系统
- 未登录无任何用户数据；401 自动登出并跳转登录
- 错误提示清晰，日志可追踪

## 风险与应对
- 后端未启动：继续保留Mock开关（开发环境）；上线前切换真实接口
- 邮件能力：若无邮件服务，先用模拟回调完成UI流程与接口占位
- OAuth配置：确保后端回调URL与前端路由一致